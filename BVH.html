

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Bounding volume hierarchies &mdash; EBGeometry 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/my_theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Overview" href="Implementation.html" />
    <link rel="prev" title="DCEL mesh structure" href="DCEL.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> EBGeometry
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html#quickstart">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html#features">Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Concepts</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Concepts.html">Signed distance fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="Concepts.html#transformations">Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Concepts.html#unions">Unions</a></li>
<li class="toctree-l1"><a class="reference internal" href="DCEL.html">DCEL mesh structure</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Bounding volume hierarchies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-concept">Basic concept</a></li>
<li class="toctree-l2"><a class="reference internal" href="#construction">Construction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#signed-distance-function">Signed distance function</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Implementation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Implementation.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="ImplemVec.html">Vector types</a></li>
<li class="toctree-l1"><a class="reference internal" href="ImplemBVH.html">Bounding volume hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="ImplemDCEL.html">DCEL</a></li>
<li class="toctree-l1"><a class="reference internal" href="ImplemSDF.html">Signed distance function</a></li>
<li class="toctree-l1"><a class="reference internal" href="ImplemUnion.html">Unions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Parsers.html">Reading data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guided examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Examples.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example_Basic.html">Basic example</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example_Union.html">Unions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example_AMReX.html">Integration with AMReX</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example_Chombo3.html">Integration with Chombo3</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ZZReferences.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EBGeometry</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Bounding volume hierarchies</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/BVH.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="bounding-volume-hierarchies">
<span id="chap-bvh"></span><h1>Bounding volume hierarchies<a class="headerlink" href="#bounding-volume-hierarchies" title="Permalink to this heading">¶</a></h1>
<section id="basic-concept">
<h2>Basic concept<a class="headerlink" href="#basic-concept" title="Permalink to this heading">¶</a></h2>
<p>Bounding Volume Hierarchies (BVHs) are comparatively simple data structures that can accelerate closest-point searches by orders of magnitude.
BVHs are tree structures where the regular nodes are bounding volumes that enclose all geometric primitives (e.g. polygon faces) further down in the hierarchy.
This means that every node in a BVH is associated with a <em>bounding volume</em>.
The bounding volume can, in principle, be any type of volume.
Moreover, there are two types of nodes in a BVH:</p>
<ul class="simple">
<li><p><strong>Regular nodes.</strong> These do not contain any of the primitives/objects.
They are also called interior nodes, and store references to their child nodes.</p></li>
<li><p><strong>Leaf nodes.</strong> These lie at the bottom of the BVH tree and each of them contain a subset of the geometric primitives.</p></li>
</ul>
<p><a class="reference internal" href="#fig-trianglesbvh"><span class="std std-numref">Fig. 4</span></a> shows a concept of BVH partitioning of a set of triangles.
Here, <span class="math notranslate nohighlight">\(P\)</span> is a regular node whose bounding volume encloses all geometric primitives in it’s subtree.
It’s bounding volume, an axis-aligned bounding box or AABB for short, is illustrated by a dashed rectangle.
The interior node <span class="math notranslate nohighlight">\(P\)</span> stores references to the leaf nodes <span class="math notranslate nohighlight">\(L\)</span> and <span class="math notranslate nohighlight">\(R\)</span>.
As shown in <a class="reference internal" href="#fig-trianglesbvh"><span class="std std-numref">Fig. 4</span></a>, <span class="math notranslate nohighlight">\(L\)</span> contains 5 triangles enclosed by another AABB.
The other child node <span class="math notranslate nohighlight">\(R\)</span> contains 6 triangles that are also enclosed by an AABB.
Note that the bounding volume for <span class="math notranslate nohighlight">\(P\)</span> encloses the bounding volumes of <span class="math notranslate nohighlight">\(L\)</span> and <span class="math notranslate nohighlight">\(R\)</span> and that the bounding volumes for <span class="math notranslate nohighlight">\(L\)</span> and <span class="math notranslate nohighlight">\(R\)</span> contain a small overlap.</p>
<figure class="align-center" id="id1">
<span id="fig-trianglesbvh"></span><a class="reference internal image-reference" href="_images/TrianglesBVH.png"><img alt="_images/TrianglesBVH.png" src="_images/TrianglesBVH.png" style="width: 480px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text">Example of BVH partitioning for enclosing triangles. The regular node <span class="math notranslate nohighlight">\(P\)</span> contains two leaf nodes <span class="math notranslate nohighlight">\(L\)</span> and <span class="math notranslate nohighlight">\(R\)</span> which contain the primitives (triangles).</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>There is no fundamental limitation to what type of primitives/objects can be enclosed in BVHs, which makes BVHs useful beyond triangulated data sets.
For example, analytic signed distance functions can also be embedded in BVHs, provided that we can construct a bounding volume that encloses the object.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>EBGeometry limited to binary trees, but supports <span class="math notranslate nohighlight">\(k\)</span> -ary trees where each regular node has <span class="math notranslate nohighlight">\(k\)</span> children nodes.</p>
</div>
</section>
<section id="construction">
<h2>Construction<a class="headerlink" href="#construction" title="Permalink to this heading">¶</a></h2>
<p>BVHs have extremely flexible rules regarding their construction.
For example, the child nodes <span class="math notranslate nohighlight">\(L\)</span> and <span class="math notranslate nohighlight">\(R\)</span> in <a class="reference internal" href="#fig-trianglesbvh"><span class="std std-numref">Fig. 4</span></a> could be partitioned in any number of ways, with the only requirement being that each child node gets at least one triangle.</p>
<p>Although the rules for BVH construction are highly flexible, performant BVHs are completely reliant on having balanced trees with the following heuristic properties:</p>
<ul class="simple">
<li><p><strong>Tight bounding volumes</strong> that enclose the primitives as tightly as possible.</p></li>
<li><p><strong>Minimal overlap</strong> between the bounding volumes.</p></li>
<li><p><strong>Balanced</strong>, in the sense that the tree depth does not vary greatly through the tree, and there is approximately the same number of primitives in each leaf node.</p></li>
</ul>
<p>Construction of a BVH is usually done recursively, from top to bottom (so-called top-down construction).
Alternative construction methods also exist, but are not used in EBGeometry.
In this case one can represent the BVH construction of a <span class="math notranslate nohighlight">\(k\)</span> -ary tree is done through a single function:</p>
<div class="math notranslate nohighlight" id="equation-partition">
<span class="eqno">(2)<a class="headerlink" href="#equation-partition" title="Permalink to this equation">¶</a></span>\[\textrm{Partition}\left(\vec{O}\right): \vec{O} \rightarrow \left(\vec{O}_1, \vec{O}_2, \ldots, \vec{O}_k\right),\]</div>
<p>where <span class="math notranslate nohighlight">\(\vec{O}\)</span> is an input a list of objects/primitives, which is <em>partitioned</em> into <span class="math notranslate nohighlight">\(k\)</span> new list of primitives.
Note that the lists <span class="math notranslate nohighlight">\(\vec{O}_i\)</span> do not contain duplicates, there is a unique set of primitives associated in each new leaf node.
Top-down construction can thus be illustrated as a recursive procedure:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>topDownConstruction(Objects):
   partitionedObjects = Partition(Objects)

   forall p in partitionedObjects:
      child = insertChildNode(newObjects)

      if(enoughPrimitives(child)):
         child.topDownConstruction(child.objects)
</pre></div>
</div>
<p>In practice, the above procedure is supplemented by more sophisticated criteria for terminating the recursion, as well as routines for creating the bounding volumes around the newly inserted nodes.
EBGeometry provides these by letting the top-down construction calls take polymorphic lambdas as arguments for partitioning, termination, and bounding volume construction.</p>
</section>
<section id="signed-distance-function">
<h2>Signed distance function<a class="headerlink" href="#signed-distance-function" title="Permalink to this heading">¶</a></h2>
<p>When computing the signed distance function to objects embedded in a BVH, one takes advantage of the hierarchical embedding of the primitives.
Consider the case in <a class="reference internal" href="#fig-treepruning"><span class="std std-numref">Fig. 5</span></a>, where the goal of the BVH traversal is to minimize the number of branches and nodes that are visited.
For the traversal algorithm we consider the following steps:</p>
<ul class="simple">
<li><p>When descending from node <span class="math notranslate nohighlight">\(P\)</span> we determine that we first investigate the left subtree (node <span class="math notranslate nohighlight">\(A\)</span>) since its bounding volume is closer than the bounding volumes for the other subtree.
The other subtree will is investigated after we have recursed to the bottom of the <span class="math notranslate nohighlight">\(A\)</span> subtree.</p></li>
<li><p>Since <span class="math notranslate nohighlight">\(A\)</span> is a leaf node, we find the signed distance from <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> to the primitives in <span class="math notranslate nohighlight">\(A\)</span>.
This requires us to iterate over all the triangles in <span class="math notranslate nohighlight">\(A\)</span>.</p></li>
<li><p>When moving back to <span class="math notranslate nohighlight">\(P\)</span>, we find that the distance to the primitives in <span class="math notranslate nohighlight">\(A\)</span> is shorter than the distance from <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> to the bounding volume that encloses nodes <span class="math notranslate nohighlight">\(B\)</span> and <span class="math notranslate nohighlight">\(C\)</span>.
This immediately permits us to prune the entire subtree containing <span class="math notranslate nohighlight">\(B\)</span> and <span class="math notranslate nohighlight">\(C\)</span>.</p></li>
</ul>
<figure class="align-center" id="id2">
<span id="fig-treepruning"></span><a class="reference internal image-reference" href="_images/TreePruning.png"><img alt="_images/TreePruning.png" src="_images/TreePruning.png" style="width: 480px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Example of BVH tree pruning.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Note that all BVH traversal algorithms become inefficient when the primitives are all at approximately the same distance from the query point.
For example, it is necessary to traverse almost the entire tree when one tries to compute the signed distance at the origin of a tessellated sphere.</p>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Implementation.html" class="btn btn-neutral float-right" title="Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="DCEL.html" class="btn btn-neutral float-left" title="DCEL mesh structure" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Robert Marskar.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>